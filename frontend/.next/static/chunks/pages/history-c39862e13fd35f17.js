(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[272],{1202:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>c});var s=a(7876),r=a(4232),l=a(7328),n=a.n(l),o=a(8230),i=a.n(o);function d(e){let{history:t,loading:a,page:r,totalPages:l,pageSize:n,totalRecords:o,onPageChange:i,onPageSizeChange:d}=e;return a?(0,s.jsxs)("div",{className:"py-16 flex flex-col items-center justify-center",children:[(0,s.jsx)("div",{className:"relative",children:(0,s.jsx)("div",{className:"h-16 w-16 rounded-full border-t-4 border-b-4 border-blue-500 animate-spin"})}),(0,s.jsx)("p",{className:"mt-4 text-gray-600 font-medium",children:"Loading results..."})]}):t.length?(0,s.jsxs)("div",{className:"p-4",children:[(0,s.jsxs)("div",{className:"mb-6 flex flex-wrap justify-between items-center",children:[(0,s.jsxs)("span",{className:"text-gray-600 font-medium",children:["Showing ",(0,s.jsx)("span",{className:"font-bold text-gray-800",children:r*n+1})," to",(0,s.jsx)("span",{className:"font-bold text-gray-800",children:Math.min((r+1)*n,o)})," of",(0,s.jsx)("span",{className:"font-bold text-gray-800",children:o})," results"]}),(0,s.jsxs)("div",{className:"flex items-center bg-gray-50 px-3 py-1 rounded-md",children:[(0,s.jsx)("span",{className:"mr-3 text-gray-600 font-medium",children:"Items per page:"}),(0,s.jsx)("select",{value:n,onChange:d,className:"border border-gray-300 rounded-md py-1 px-2 bg-white focus:outline-none focus:ring-2 focus:ring-blue-500",children:[5,10,25,50].map(e=>(0,s.jsx)("option",{value:e,children:e},e))})]})]}),(0,s.jsx)("div",{className:"overflow-x-auto",children:(0,s.jsxs)("table",{className:"min-w-full bg-white rounded-lg overflow-hidden",children:[(0,s.jsx)("thead",{className:"bg-gray-100",children:(0,s.jsx)("tr",{children:["ID","Date","Filename","People Count"].map(e=>(0,s.jsx)("th",{className:"py-3 px-4 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider border-b",children:e},e))})}),(0,s.jsx)("tbody",{className:"divide-y divide-gray-200",children:t.map(e=>{let{id:t,timestamp:a,original_filename:r,people_count:l}=e;return(0,s.jsxs)("tr",{className:"hover:bg-gray-50 transition-colors duration-150",children:[(0,s.jsx)("td",{className:"py-3 px-4 text-sm font-medium text-gray-900",children:t}),(0,s.jsx)("td",{className:"py-3 px-4 text-sm text-gray-600",children:new Date(a).toLocaleString()}),(0,s.jsx)("td",{className:"py-3 px-4 text-sm text-gray-600 truncate max-w-[200px]",children:r}),(0,s.jsx)("td",{className:"py-3 px-4 text-center",children:(0,s.jsx)("span",{className:"px-3 py-1 text-sm font-semibold rounded-full bg-blue-100 text-blue-800",children:l})})]},t)})})]})}),(0,s.jsx)("div",{className:"mt-6 flex flex-wrap justify-center sm:justify-between items-center",children:(0,s.jsx)("nav",{className:"inline-flex rounded-md shadow-sm",children:[["First",0],["Previous",r-1],["Next",r+1],["Last",l-1]].map((e,t)=>{let[a,r]=e;return(0,s.jsx)("button",{onClick:()=>i(r),disabled:r<0||r>=l,className:"px-3 py-2 border text-sm font-medium transition-colors duration-150 rounded-".concat(0===t?"l":3===t?"r":"","-md ").concat(r<0||r>=l?"bg-gray-100 text-gray-400 cursor-not-allowed":"bg-white text-gray-700 hover:bg-gray-50 focus:ring-2 focus:ring-blue-500","\n              "),"aria-label":"".concat(a," page"),children:a},a)})})})]}):(0,s.jsxs)("div",{className:"py-16 flex flex-col items-center justify-center",children:[(0,s.jsx)("p",{className:"mt-4 text-xl text-gray-600 font-medium",children:"No detection records found"}),(0,s.jsx)("p",{className:"text-gray-500",children:"Try adjusting your filters to see more results"})]})}function c(){let[e,t]=(0,r.useState)([]),[a,l]=(0,r.useState)([]),[o,c]=(0,r.useState)(!1),[m,x]=(0,r.useState)(null),[u,h]=(0,r.useState)(0),[p,g]=(0,r.useState)(0),[b,f]=(0,r.useState)(0),[y,j]=(0,r.useState)(10),[N,v]=(0,r.useState)(""),[w,P]=(0,r.useState)({minPeople:"",maxPeople:"",dateFrom:"",dateTo:""}),S=(0,r.useCallback)(async()=>{c(!0),x(null);try{let e=new URLSearchParams({skip:u*y,limit:y});Object.entries(w).forEach(t=>{let[a,s]=t;s&&e.append(a.replace(/([A-Z])/g,"_$1").toLowerCase(),s)});let[a,s]=await Promise.all([fetch("http://localhost:8386/api/v1/history?".concat(e)),fetch("http://localhost:8386/api/v1/history/count?".concat(e))]);if(!a.ok||!s.ok)throw Error("Failed to fetch data from server.");let r=await a.json(),n=await s.json();t(r),l(r),f(n.count),g(Math.ceil(n.count/y))}catch(e){x(e.message||"Failed to load history. Please try again.")}finally{c(!1)}},[u,y,w]);(0,r.useEffect)(()=>{S()},[u,y,w]);let _=t=>{if(!t){l(e);return}let a=t.toLowerCase();l(e.filter(e=>{var t;return null===(t=e.original_filename)||void 0===t?void 0:t.toLowerCase().includes(a)}))};return(0,s.jsxs)("div",{className:"container mx-auto px-6 py-10 max-w-7xl",children:[(0,s.jsx)(n(),{children:(0,s.jsx)("title",{children:"Detection History | Person Detection System"})}),(0,s.jsxs)("header",{className:"mb-8",children:[(0,s.jsx)("h1",{className:"text-4xl font-bold mb-6 text-gray-800 border-b-2 pb-3",children:"Detection History"}),(0,s.jsx)(i(),{href:"/",className:"text-blue-600 hover:text-blue-800 font-medium flex items-center transition-all",children:"← Back to Upload"})]}),(0,s.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow-md border border-gray-200 mb-8",children:[(0,s.jsx)("h2",{className:"text-xl font-semibold mb-4 text-gray-700",children:"Filters"}),(0,s.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[{name:"minPeople",type:"number",placeholder:"Min People"},{name:"maxPeople",type:"number",placeholder:"Max People"},{name:"dateFrom",type:"date",placeholder:"From"},{name:"dateTo",type:"date",placeholder:"To"}].map(e=>{let{name:t,type:a,placeholder:r}=e;return(0,s.jsxs)("div",{className:"flex flex-col",children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:t.replace(/([A-Z])/g," $1")}),(0,s.jsx)("input",{type:a,name:t,value:w[t],onChange:e=>P(a=>({...a,[t]:e.target.value})),className:"w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition",placeholder:r})]},t)})})]}),(0,s.jsx)("div",{className:"mb-4",children:(0,s.jsx)("input",{type:"text",name:"search",value:N,onChange:e=>{let t=e.target.value;v(t),_(t)},className:"w-full p-3 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition",placeholder:"Search file name..."})}),m&&(0,s.jsx)("div",{className:"mb-8 p-4 bg-red-50 border-l-4 border-red-500 text-red-700 rounded-md shadow-sm",children:(0,s.jsx)("p",{children:m})}),(0,s.jsx)("div",{className:"table-container",children:(0,s.jsx)(d,{history:a,loading:o,page:u,totalPages:p,pageSize:y,totalRecords:b,onPageChange:h,onPageSizeChange:e=>j(Number(e.target.value))})})]})}},1284:(e,t,a)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/history",function(){return a(1202)}])}},e=>{var t=t=>e(e.s=t);e.O(0,[695,636,593,792],()=>t(1284)),_N_E=e.O()}]);